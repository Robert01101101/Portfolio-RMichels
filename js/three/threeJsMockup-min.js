var mockupMesh,initialMockupMeshRotation,scene=new THREE.Scene,canvas=document.querySelector("#threeModel"),renderer=new THREE.WebGLRenderer({canvas:canvas,alpha:!0,antialias:!0}),isPhone=canvas.hasAttribute("mockup-phone");const spinner=document.getElementById("spinner");var origHololensPosition,hololens;const video=document.getElementById("video");var videoTexture;function throttle(e,n){let o,i;return function(){const t=this,a=arguments;i?(clearTimeout(o),o=setTimeout((function(){Date.now()-i>=n&&(e.apply(t,a),i=Date.now())}),n-(Date.now()-i))):(e.apply(t,a),i=Date.now())}}video&&(video.play().catch((function(e){console.error("Error attempting to play the video:",e),video.load()})),video.addEventListener("error",(function(e){console.error("Error loading video:",e),throttledReload()})),video.addEventListener("stalled",(function(){console.warn("Video stalled, reloading..."),throttledReload()})),videoTexture=new THREE.VideoTexture(video));const throttledReload=throttle((function(){console.warn("Reloading video..."),video.load(),video.play().catch((function(e){console.error("Error attempting to play the video after reload:",e)}))}),2e3);function hideSpinner(){spinner&&(spinner.style.display="none",canvas.style.display="block")}var loader=new THREE.GLTFLoader,path=isPhone?"/assets/models/phone.glb":"/assets/models/hlAndBridgeCombined.glb";function handle_load(e){mockupMesh=e.scene.children[0],initialMockupMeshRotation=mockupMesh.rotation.clone();var n=[];mockupMesh.traverse((function(e){if("Hololens"===e.name&&(origHololensPosition=new THREE.Vector3(e.position.x,e.position.y,e.position.z),hololens=e),e.name.includes("Ray")){const o=e.geometry.getAttribute("position");createLine((new THREE.Vector3).fromBufferAttribute(o,0),(new THREE.Vector3).fromBufferAttribute(o,1)),n.push(e)}e.isMesh&&("Hologram"===e.material.name&&(e.material.emissive=new THREE.Color(5592439),holograms.push(e)),isPhone&&"screen"===e.material.name?e.material=new THREE.MeshBasicMaterial({map:videoTexture}):e.material.blending=THREE.NormalBlending,e.material.needsUpdate=!0)})),holograms.forEach((e=>{hololens.attach(e)})),n&&n.forEach((e=>mockupMesh.remove(e))),scene.add(mockupMesh),isPhone&&(mockupMesh.position.x=.4),hideSpinner()}loader.load(path,handle_load);var holograms=[],rays=[];const vertexShader="\n  attribute float distanceAlongLine;\n  varying float vDistance;\n\n  void main() {\n    vDistance = distanceAlongLine;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n",fragmentShader="\n  varying float vDistance;\n\n  uniform float startFadeIn;\n  uniform float startSolid;\n  uniform float endSolid;\n  uniform float endFadeOut;\n  uniform float maxAlpha;\n  uniform vec3 color; // Base color\n  uniform vec3 emissiveColor; // New uniform for emissive color\n\n  void main() {\n    float alpha = 0.0;\n    if (vDistance < startFadeIn) {\n      alpha = 0.0;\n    } else if (vDistance < startSolid) {\n      alpha = maxAlpha * (vDistance - startFadeIn) / (startSolid - startFadeIn);\n    } else if (vDistance < endSolid) {\n      alpha = maxAlpha;\n    } else if (vDistance < endFadeOut) {\n      alpha = maxAlpha * (1.0 - (vDistance - endSolid) / (endFadeOut - endSolid));\n    } else {\n      alpha = 0.0;\n    }\n    vec3 finalColor = mix(color, emissiveColor, alpha); // Mix between base and emissive color\n    gl_FragColor = vec4(finalColor, alpha); // Use the final color with varying alpha\n  }\n";function createLine(e,n){const o=[];o.push(e),o.push(n);const i=(new THREE.BufferGeometry).setFromPoints(o),t=new Float32Array([0,1]);i.setAttribute("distanceAlongLine",new THREE.BufferAttribute(t,1));const a=new THREE.ShaderMaterial({vertexShader:vertexShader,fragmentShader:fragmentShader,transparent:!0,uniforms:{startFadeIn:{value:.15},startSolid:{value:.5},endSolid:{value:.55},endFadeOut:{value:.95},maxAlpha:{value:1},color:{value:new THREE.Color(.7,.7,1)},emissiveColor:{value:new THREE.Color(.6,.6,1)}}}),r=new THREE.Line(i,a);rays.push(r),mockupMesh.attach(r)}var camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);camera.position.z=0,camera.position.y=0,camera.rotation.x=0;var ambientLight=isPhone?new THREE.AmbientLight(16777215):new THREE.AmbientLight(16777215,3),light=isPhone?new THREE.PointLight(9474192,.3):new THREE.PointLight(9474192,1);function resizeRendererToDisplaySize(e){const n=e.domElement,o=window.devicePixelRatio,i=n.clientWidth*o|0,t=n.clientHeight*o|0,a=n.width!==i||n.height!==t;return a&&(e.setSize(i,t,!1),windowHalfX=window.innerWidth<xlBreakPoint?window.innerWidth/2:window.innerWidth/4*3,camera.position.z=window.innerWidth>xxxxlBreakPoint?(isPhone?20:22)-xxxxlBreakPoint/smBreakPoint*(isPhone?2.3:.85):window.innerWidth>mdBreakPoint||!isPhone?(isPhone?20:22)-window.innerWidth/smBreakPoint*(isPhone?2.3:.85):10,mockupMesh&&isPhone&&(mockupMesh.position.x=window.innerWidth>mdBreakPoint?.4:0)),a}isPhone?light.position.set(-6,7,6):light.position.set(-2,10,8),scene.add(ambientLight),scene.add(light),renderer.render(scene,camera);var mouseX=0,mouseY=0,windowHalfX=window.innerWidth<xlBreakPoint?window.innerWidth/2:window.innerWidth/4*3,windowHalfY=window.innerHeight/4;function onDocumentMouseMove(e){mouseX=(windowHalfX-e.clientX)/1e3,mouseY=(windowHalfY-e.clientY)/1e3}function animate(){if(requestAnimationFrame(animate),resizeRendererToDisplaySize(renderer)){const e=renderer.domElement;camera.aspect=e.clientWidth/e.clientHeight,camera.updateProjectionMatrix()}if(camera&&scene){var e=isPhone?window.innerWidth>mdBreakPoint?.05:0:-.02,n=5e-4*Date.now();camera.position.x+=e+(mouseX+Math.sin(n)/2-camera.position.x)*(isPhone?.05:.03),camera.position.y+=(-mouseY-camera.position.y)*(isPhone?.03:.1)+(isPhone?0:.2);var o=new THREE.Vector3(scene.position.x,scene.position.y,scene.position.z);isPhone||(o.y+=7.5,o.x-=1.5),camera.lookAt(o)}var i;rays.forEach(((e,o)=>{const t=.8*perlin.get((.4*camera.position.x+o/5+n)/2,.4*camera.position.y/2);e.material.uniforms.maxAlpha.value=t,i=e.material.uniforms.maxAlpha.value}));const t=new THREE.Color(4210773),a=new THREE.Color(11184844),r=t.clone().lerp(a,i);var s=3*Math.sin(.001*Date.now());holograms.forEach((e=>{e.material.emissive=r})),hololens&&(hololens.position.z=origHololensPosition.z+s,hololens.position.x=origHololensPosition.x-mouseX/200),renderer.render(scene,camera)}function initializePerlin(){perlin.seed(Math.random())}function scrollUpdate(e){if(null==e)return;const n=e.animatedScroll;if(canvas&&mockupMesh){const e=quadraticTransform((n-(canvas.getBoundingClientRect().top+n-canvas.height/6))/(isPhone?1200:2e3));mockupMesh.rotation.y=initialMockupMeshRotation.y+e}}function quadraticTransform(e){return(e>=0?1:-1)*Math.pow(e,2)}document.addEventListener("mousemove",onDocumentMouseMove,!1),animate(),initializePerlin(),window.addEventListener("load",(()=>{window.lenis&&window.lenis.on("scroll",(e=>{scrollUpdate(e)}))}));